# security-test-worker

Email-to-SMS gateway using Cloudflare Workers and Twilio.

## Overview

This worker receives emails and converts them to SMS messages using Twilio's API.

**Configuration:**
- **Domain:** test.example.com
- **Email Pattern:** *@sms.test.example.com
- **Twilio Phone:** +15551234567
- **Phone Extraction:** email_prefix
- **Content Source:** body_text

## Features

- ✅ Email-to-SMS conversion
- ✅ Rate limiting (10 msgs/sender/hour, 20 msgs/recipient/hour)
- ✅ Logging (analytics_engine)
- ✅ Automatic retries (max 3)
## Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Configure Secrets

```bash
wrangler secret put TWILIO_ACCOUNT_SID
# Enter: AC1234567890abcdef1234567890abcdef

wrangler secret put TWILIO_AUTH_TOKEN
# Enter: 1234567890abcdef1234567890abcdef

wrangler secret put TWILIO_PHONE_NUMBER
# Enter: +15551234567
```

### 3. Create KV Namespace

```bash
# Create KV namespace for rate limiting
wrangler kv:namespace create "RATE_LIMIT_KV"

# Update wrangler.toml with the returned namespace ID
```

### 4. Deploy

```bash
npm run deploy
```

### 5. Configure Email Routing

1. Go to [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. Navigate to Email → Email Routing
3. Add domain: `test.example.com`
4. Create routing rule:
   - **Match:** `*@sms.test.example.com`
   - **Action:** Send to Worker
   - **Worker:** `security-test-worker`

## Usage

### Sending SMS via Email

Send an email to: `15551234567@sms.test.example.com`

**Email Address Format:** `<phone-number>@sms.test.example.com`
- Example: `15551234567@sms.test.example.com`
- Example: `442012345678@sms.test.example.com`

**Message Content:** Email body (text only)
**Max Length:** 160 characters

## Development

### Local Development

```bash
npm run dev
```

### Testing

```bash
npm test
```

### Type Checking

```bash
npm run check
```

## Configuration

### Environment Variables

Set using `wrangler secret put`:

- `TWILIO_ACCOUNT_SID` - Your Twilio Account SID
- `TWILIO_AUTH_TOKEN` - Your Twilio Auth Token
- `TWILIO_PHONE_NUMBER` - Your Twilio phone number

### Rate Limits

- **Per Sender:** 10 messages/hour
- **Per Recipient:** 20 messages/hour
- **Global:** 1000 messages/day

## Monitoring

### Logs

Logs are stored in Analytics Engine dataset: `EMAIL_SMS_ANALYTICS`

View logs:
```bash
wrangler tail
```

### Health Check

```bash
curl https://security-test-worker.test.example.com/health
```

## Troubleshooting

### SMS Not Sending

1. Check Twilio credentials are set correctly
2. Verify phone number format (E.164: +15551234567)
3. Check Twilio account balance
4. Review worker logs: `wrangler tail`

### Email Not Routing

1. Verify Email Routing is configured in Cloudflare
2. Check email pattern matches: `*@sms.test.example.com`
3. Ensure worker is deployed

### Rate Limits

If you're hitting rate limits, you can:
1. Increase limits in code
2. Redeploy worker
3. Check rate limit counters in KV namespace

## License

MIT

## Support

- [Cloudflare Workers Docs](https://developers.cloudflare.com/workers/)
- [Twilio API Docs](https://www.twilio.com/docs/sms)
- [Email Routing Docs](https://developers.cloudflare.com/email-routing/)

---

Generated by email-to-sms-streamlit-generator on 2025-11-14T00:58:49.510010Z