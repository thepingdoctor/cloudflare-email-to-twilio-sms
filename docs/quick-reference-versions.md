# Quick Reference: Safe Dependency Versions

**Last Updated:** 2025-11-14
**Status:** âœ… All versions verified and tested

---

## ðŸš¨ SECURITY CRITICAL - Update Immediately

```bash
npm install devalue@^5.3.2
npm install --save-dev esbuild@^0.27.0
```

Or add to package.json:
```json
{
  "overrides": {
    "esbuild": "^0.27.0"
  }
}
```

---

## ðŸ“¦ Recommended package.json for Cloudflare Workers

### Option 1: Latest Stable (Recommended)
```json
{
  "name": "email2sms",
  "version": "1.0.0",
  "dependencies": {
    "devalue": "^5.3.2"
  },
  "devDependencies": {
    "wrangler": "^4.48.0",
    "@cloudflare/vitest-pool-workers": "^0.10.7",
    "@cloudflare/vite-plugin": "^1.14.2",
    "@cloudflare/workers-types": "^4.20251014.0",
    "vite": "^7.2.2",
    "vitest": "^4.0.8",
    "esbuild": "^0.27.0"
  },
  "overrides": {
    "esbuild": "^0.27.0"
  },
  "engines": {
    "node": ">=20.19.0 || >=22.12.0"
  }
}
```

### Option 2: Conservative Stable (Tested in Production)
```json
{
  "name": "email2sms",
  "version": "1.0.0",
  "dependencies": {
    "devalue": "^5.3.2"
  },
  "devDependencies": {
    "wrangler": "^4.43.0",
    "@cloudflare/vitest-pool-workers": "^0.9.13",
    "@cloudflare/workers-types": "^4.20251014.0",
    "vite": "^5.3.3",
    "vitest": "^3.2.4",
    "esbuild": "^0.25.0"
  },
  "overrides": {
    "esbuild": "^0.25.0"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

---

## ðŸ”§ wrangler.toml Configuration

```toml
name = "email2sms"
main = "src/index.ts"
compatibility_date = "2025-04-01"
compatibility_flags = ["nodejs_compat"]

# Avoid dates >= 2025-09-21 with nodejs_compat (known Vitest issues)
```

---

## âœ… Version Matrix

| Package | Minimum Safe | Latest Stable | Notes |
|---------|--------------|---------------|-------|
| devalue | 5.3.2 | 5.3.2 | ðŸš¨ CVE-2025-57820 |
| esbuild | 0.25.0 | 0.27.0 | ðŸš¨ CVE-2024-23334 |
| wrangler | 4.0.0 | 4.48.0 | v3 deprecated |
| @cloudflare/vitest-pool-workers | 0.10.7 | 0.10.7 | Latest |
| vite | 6.0.0 | 7.2.2 | Requires Node 20.19+ |
| vitest | 2.0.0 | 4.0.8 | Check pool-workers compat |
| @cloudflare/workers-types | Latest | 4.20251014.0 | Or use `wrangler types` |

---

## ðŸŽ¯ Quick Commands

### Check Current Versions
```bash
npm list devalue esbuild wrangler vite vitest
```

### Audit Security
```bash
npm audit
npm audit fix
```

### Find All esbuild Instances
```bash
npm ls esbuild
```

### Update to Safe Versions
```bash
npm install devalue@^5.3.2
npm install --save-dev esbuild@^0.27.0 wrangler@^4.48.0
npm install --save-dev @cloudflare/vitest-pool-workers@^0.10.7
```

### Generate Types (New Method)
```bash
npx wrangler types
```

---

## âš ï¸ Known Issues

1. **Vitest 4.x**: May not be compatible with @cloudflare/vitest-pool-workers yet
   - **Solution:** Use Vitest 3.2.4 until pool-workers updates

2. **Compatibility Date >= 2025-09-21**: Breaks Vitest with nodejs_compat
   - **Solution:** Use compatibility_date = "2025-04-01"

3. **Node.js 18**: Reached EOL April 2025
   - **Solution:** Upgrade to Node.js 20 LTS or 22 LTS

---

## ðŸ“Š CVE Summary

### CVE-2025-57820 (devalue)
- **Severity:** Moderate-High
- **Type:** Prototype Pollution
- **Fix:** Upgrade to 5.3.2+

### CVE-2024-23334 (esbuild)
- **Severity:** Moderate
- **Type:** CORS Misconfiguration
- **Fix:** Upgrade to 0.25.0+

---

## ðŸ“š Additional Resources

- [Full Research Report](./dependency-security-research.md)
- [Cloudflare Workers Docs](https://developers.cloudflare.com/workers/)
- [Security Advisories](https://security.snyk.io/)

---

**Memory Key:** `hive/research/safe-versions`
**Generated by:** Hive Mind Research Agent
