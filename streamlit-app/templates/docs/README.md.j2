# {{ basic.worker_name }}

Email-to-SMS gateway using Cloudflare Workers and Twilio.

## Overview

This worker receives emails and converts them to SMS messages using Twilio's API.

**Configuration:**
- **Domain:** {{ basic.domain }}
- **Email Pattern:** {{ basic.email_pattern | replace('{domain}', basic.domain) }}
- **Twilio Phone:** {{ twilio.phone_number }}
- **Phone Extraction:** {{ routing.phone_extraction_method }}
- **Content Source:** {{ routing.content_source }}

## Features

- ✅ Email-to-SMS conversion
{% if rate_limit.enabled %}- ✅ Rate limiting ({{ rate_limit.per_sender }} msgs/sender/hour, {{ rate_limit.per_recipient }} msgs/recipient/hour)
{% endif %}{% if logging.enabled %}- ✅ Logging ({{ logging.storage_type }})
{% endif %}{% if security.enable_sender_whitelist %}- ✅ Sender whitelist
{% endif %}{% if retry.enabled %}- ✅ Automatic retries (max {{ retry.max_retries }})
{% endif %}{% if integrations.enable_url_shortening %}- ✅ URL shortening
{% endif %}{% if integrations.enable_error_notifications %}- ✅ Error notifications
{% endif %}
## Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Configure Secrets

```bash
wrangler secret put TWILIO_ACCOUNT_SID
# Enter: {{ twilio.account_sid or 'Your Twilio Account SID' }}

wrangler secret put TWILIO_AUTH_TOKEN
# Enter: {{ twilio.auth_token or 'Your Twilio Auth Token' }}

wrangler secret put TWILIO_PHONE_NUMBER
# Enter: {{ twilio.phone_number or 'Your Twilio Phone Number' }}
```

{% if rate_limit.enabled and rate_limit.storage == 'kv' %}
### 3. Create KV Namespace

```bash
# Create KV namespace for rate limiting
wrangler kv:namespace create "RATE_LIMIT_KV"

# Update wrangler.toml with the returned namespace ID
```

{% endif %}
### {{ (rate_limit.enabled and rate_limit.storage == 'kv') | ternary('4', '3') }}. Deploy

```bash
npm run deploy
```

### {{ (rate_limit.enabled and rate_limit.storage == 'kv') | ternary('5', '4') }}. Configure Email Routing

1. Go to [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. Navigate to Email → Email Routing
3. Add domain: `{{ basic.domain }}`
4. Create routing rule:
   - **Match:** `{{ basic.email_pattern | replace('{domain}', basic.domain) }}`
   - **Action:** Send to Worker
   - **Worker:** `{{ basic.worker_name }}`

## Usage

### Sending SMS via Email

Send an email to: `{{ basic.email_pattern | replace('{domain}', basic.domain) | replace('*', '15551234567') }}`

{% if routing.phone_extraction_method == 'email_prefix' %}
**Email Address Format:** `<phone-number>@sms.{{ basic.domain }}`
- Example: `15551234567@sms.{{ basic.domain }}`
- Example: `442012345678@sms.{{ basic.domain }}`
{% endif %}
{% if routing.phone_extraction_method == 'subject_line' %}
**Subject Line Format:** Include phone number in subject
- Example: `To: +15551234567`
- Example: `Phone: 555-123-4567`
{% endif %}
{% if routing.phone_extraction_method == 'custom_header' %}
**Custom Header Format:** Add `X-SMS-To` header
- Example: `X-SMS-To: +15551234567`
{% endif %}

{% if routing.content_source == 'body_text' %}**Message Content:** Email body (text only)
{% elif routing.content_source == 'body_html' %}**Message Content:** Email body (HTML converted to text)
{% elif routing.content_source == 'subject' %}**Message Content:** Email subject
{% elif routing.content_source == 'subject_and_body' %}**Message Content:** Email subject + body
{% endif %}
**Max Length:** {{ routing.max_message_length }} characters

## Development

### Local Development

```bash
npm run dev
```

### Testing

```bash
npm test
```

### Type Checking

```bash
npm run check
```

## Configuration

### Environment Variables

Set using `wrangler secret put`:

- `TWILIO_ACCOUNT_SID` - Your Twilio Account SID
- `TWILIO_AUTH_TOKEN` - Your Twilio Auth Token
- `TWILIO_PHONE_NUMBER` - Your Twilio phone number

### Rate Limits

{% if rate_limit.enabled %}- **Per Sender:** {{ rate_limit.per_sender }} messages/hour
- **Per Recipient:** {{ rate_limit.per_recipient }} messages/hour
- **Global:** {{ rate_limit.global_limit }} messages/day
{% else %}Rate limiting is disabled.
{% endif %}
{% if security.enable_sender_whitelist %}
### Sender Whitelist

Only these email addresses can send SMS:
{% for email in security.sender_whitelist %}
- {{ email }}
{% endfor %}
{% endif %}

## Monitoring

{% if logging.enabled %}
### Logs

{% if logging.storage_type == 'analytics_engine' %}Logs are stored in Analytics Engine dataset: `{{ cloudflare.analytics_dataset_name }}`

View logs:
```bash
wrangler tail
```
{% elif logging.storage_type == 'kv' %}Logs are stored in KV namespace with 7-day retention.
{% else %}Logs are written to console. View with:
```bash
wrangler tail
```
{% endif %}
{% endif %}

### Health Check

```bash
curl https://{{ basic.worker_name }}.{{ basic.domain }}/health
```

## Troubleshooting

### SMS Not Sending

1. Check Twilio credentials are set correctly
2. Verify phone number format (E.164: +15551234567)
3. Check Twilio account balance
4. Review worker logs: `wrangler tail`

### Email Not Routing

1. Verify Email Routing is configured in Cloudflare
2. Check email pattern matches: `{{ basic.email_pattern | replace('{domain}', basic.domain) }}`
3. Ensure worker is deployed

### Rate Limits

{% if rate_limit.enabled %}If you're hitting rate limits, you can:
1. Increase limits in code
2. Redeploy worker
3. Check rate limit counters in KV namespace
{% else %}Rate limiting is disabled. Enable in configuration if needed.
{% endif %}

## License

MIT

## Support

- [Cloudflare Workers Docs](https://developers.cloudflare.com/workers/)
- [Twilio API Docs](https://www.twilio.com/docs/sms)
- [Email Routing Docs](https://developers.cloudflare.com/email-routing/)

---

Generated by {{ metadata.generated_by }} on {{ metadata.generated_at }}
