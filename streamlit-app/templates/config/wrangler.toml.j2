# Wrangler Configuration
# Generated by: {{ metadata.generated_by }}
# Generated at: {{ metadata.generated_at }}

name = "{{ basic.worker_name }}"
main = "src/index.ts"
compatibility_date = "{{ cloudflare.compatibility_date }}"
compatibility_flags = {{ cloudflare.compatibility_flags | tojson }}

# Email routing
[[email_routing]]
pattern = "{{ basic.email_pattern | replace('{domain}', basic.domain) }}"

# Environment variables (use wrangler secret for sensitive values)
[vars]
WORKER_NAME = "{{ basic.worker_name }}"
DOMAIN = "{{ basic.domain }}"

# Secrets (set using: wrangler secret put <NAME>)
# TWILIO_ACCOUNT_SID
# TWILIO_AUTH_TOKEN
# TWILIO_PHONE_NUMBER

{% if rate_limit.enabled and rate_limit.storage == 'kv' %}
# KV Namespace for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "{{ cloudflare.kv_namespace_id or 'YOUR_KV_NAMESPACE_ID' }}"
preview_id = "{{ cloudflare.kv_namespace_id or 'YOUR_PREVIEW_KV_NAMESPACE_ID' }}"

{% endif %}
{% if logging.storage_type == 'kv' %}
# KV Namespace for logging
[[kv_namespaces]]
binding = "LOGS_KV"
id = "{{ cloudflare.kv_namespace_id or 'YOUR_LOGS_KV_NAMESPACE_ID' }}"
preview_id = "{{ cloudflare.kv_namespace_id or 'YOUR_PREVIEW_LOGS_KV_NAMESPACE_ID' }}"

{% endif %}
{% if logging.storage_type == 'analytics_engine' %}
# Analytics Engine binding
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "{{ cloudflare.analytics_dataset_name }}"

{% endif %}
# Build configuration
[build]
command = "npm run build"

[build.upload]
format = "service-worker"
